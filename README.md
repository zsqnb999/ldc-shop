# LDC Shop (Next.js + Workers)

[English](./README_EN.md)

---

åŸºäº **Next.js 16**ã€**Vercel Postgres**ã€**Shadcn UI** å’Œ **Linux DO Connect** æ„å»ºçš„å¼ºå¤§çš„æ— æœåŠ¡å™¨è™šæ‹Ÿå•†å“å•†åº—ã€‚

> ğŸ’¡ **ä¹Ÿæä¾› Cloudflare Workers ç‰ˆæœ¬ï¼š** [æŸ¥çœ‹éƒ¨ç½²æŒ‡å— â†’ `_workers_v2/README.md`](./_workers_v2/README.md)

## âœ¨ ç‰¹æ€§
- **ç°ä»£æŠ€æœ¯æ ˆ**: Next.js 16 (App Router), Tailwind CSS, TypeScript.
- **Vercel åŸç”Ÿ**: ä¸€é”®éƒ¨ç½²ï¼Œè‡ªåŠ¨é…ç½® Vercel Postgres æ•°æ®åº“ã€‚
- **Linux DO é›†æˆ**: å†…ç½® OIDC ç™»å½•ä¸ EasyPay æ”¯ä»˜ã€‚
- **å•†åŸä½“éªŒ**:
    - ğŸ” **æœç´¢ä¸åˆ†ç±»ç­›é€‰**: å®¢æˆ·ç«¯å³æ—¶æœç´¢ä¸åˆ†ç±»è¿‡æ»¤ã€‚
    - ğŸ“¢ **å…¬å‘Šæ **: é¦–é¡µå…¬å‘Šé…ç½®ä¸å±•ç¤ºã€‚
    - ğŸ“ **Markdown æè¿°**: å•†å“æ”¯æŒå¯Œæ–‡æœ¬å±•ç¤ºã€‚
    - ğŸ”¥ **çƒ­é—¨ä¸æŠ˜æ‰£**: æ”¯æŒçƒ­é—¨æ ‡è®°ä¸åŸä»·/æŠ˜æ‰£ä»·å±•ç¤ºã€‚
    - â­ **è¯„åˆ†ä¸è¯„è®º**: å·²è´­ç”¨æˆ·å¯è¯„åˆ†/è¯„è®ºï¼Œåˆ—è¡¨å±•ç¤ºè¯„åˆ†ã€‚
    - ğŸ“¦ **åº“å­˜/å·²å”®æ˜¾ç¤º**: å®æ—¶å±•ç¤ºå¯ç”¨åº“å­˜ä¸å·²å”®æ•°é‡ã€‚
    - ğŸš« **é™è´­**: æŒ‰å·²æ”¯ä»˜æ¬¡æ•°é™åˆ¶è´­ä¹°ã€‚
    - ğŸ·ï¸ **è‡ªå®šä¹‰å•†åº—åç§°**: æ”¯æŒè‡ªå®šä¹‰æ˜¾ç¤ºåœ¨æ ‡é¢˜å’Œå¯¼èˆªæ çš„å•†åº—åç§°ã€‚
- **è®¢å•ä¸å‘è´§**:
    - âœ… **æ”¯ä»˜å›è°ƒéªŒç­¾**: ç­¾åä¸é‡‘é¢æ ¡éªŒã€‚
    - ğŸ **è‡ªåŠ¨å‘è´§å¡å¯†**: æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨å‘æ”¾å¡å¯†ï¼Œç¼ºè´§åˆ™æ ‡è®°å·²æ”¯ä»˜å¾…å¤„ç†ã€‚
    - ğŸ”’ **åº“å­˜é”å®š**: è¿›å…¥æ”¯ä»˜é¡µåé”å®š 5 åˆ†é’Ÿï¼Œé˜²æ­¢å¹¶å‘è¶…å–ã€‚
    - â±ï¸ **è¶…æ—¶å–æ¶ˆ**: 5 åˆ†é’Ÿæœªæ”¯ä»˜è‡ªåŠ¨å–æ¶ˆè®¢å•å¹¶é‡Šæ”¾åº“å­˜ã€‚
    - ğŸ§¾ **è®¢å•ä¸­å¿ƒ**: è®¢å•åˆ—è¡¨ä¸è¯¦æƒ…é¡µã€‚
    - ğŸ”” **å¾…æ”¯ä»˜æé†’**: é¦–é¡µæ¨ªå¹…æé†’æœªæ”¯ä»˜è®¢å•ï¼Œé˜²æ­¢æ¼å•ã€‚
    - ğŸ”„ **é€€æ¬¾ç”³è¯·**: ç”¨æˆ·å¯æäº¤é€€æ¬¾ç”³è¯·ï¼Œç®¡ç†å‘˜å®¡æ ¸ä¸å¤„ç†ï¼ˆæ”¯æŒå®¢æˆ·ç«¯ç›´æ¥é€€æ¬¾ä¸æœåŠ¡ç«¯ä»£ç†é€€æ¬¾ï¼‰ã€‚
    - ğŸ’³ **æ”¶æ¬¾ç  (Payment QR)**: ç®¡ç†å‘˜å¯ç”Ÿæˆæ”¶æ¬¾é“¾æ¥/äºŒç»´ç ï¼Œæ— éœ€å•†å“å³å¯ç›´æ¥æ”¶æ¬¾ã€‚
- **ç®¡ç†åå°**:
    - ğŸ“Š **é”€å”®ç»Ÿè®¡**: ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆ/æ€»è®¡ã€‚
    - âš ï¸ **åº“å­˜é¢„è­¦**: ä½åº“å­˜é˜ˆå€¼é…ç½®ä¸é¢„è­¦æç¤ºã€‚
    - ğŸ§© **å•†å“ç®¡ç†**: æ–°å»º/ç¼–è¾‘/ä¸Šä¸‹æ¶/æ’åº/é™è´­ã€‚
    - ğŸ·ï¸ **åˆ†ç±»ç®¡ç†**: åˆ†ç±»å¢åˆ æ”¹ã€å›¾æ ‡è®¾ç½®ã€æ’åºã€‚
    - ğŸ—‚ï¸ **åº“å­˜å¡å¯†ç®¡ç†**: æ‰¹é‡å¯¼å…¥ã€åˆ é™¤æœªä½¿ç”¨å¡å¯†ã€‚
    - ğŸ§¯ **åº“å­˜è‡ªæ„ˆ**: å…¼å®¹å†å²æ•°æ® `is_used` ä¸ºç©ºå¯¼è‡´çš„â€œé”™è¯¯ç¼ºè´§â€ï¼Œä¼šè‡ªåŠ¨å›å¡«ä¸º `false`ã€‚
    - ğŸ“¦ **æ€»åº“å­˜æ˜¾ç¤º**: é¦–é¡µå±•ç¤ºåº“å­˜åŒ…å«â€œå¯ç”¨+é”å®šâ€ï¼Œé¿å…ç”¨æˆ·å› é”å®šåº“å­˜è¯¯ä»¥ä¸ºå”®ç½„ã€‚
    - ğŸ’³ **è®¢å•ä¸é€€æ¬¾**: åˆ†é¡µ/æœç´¢/ç­›é€‰ã€è®¢å•è¯¦æƒ…ã€æ ‡è®°å·²æ”¯ä»˜/å·²å‘è´§/å–æ¶ˆã€ä¸¤æ­¥é€€æ¬¾æµç¨‹ã€‚
    - ğŸ§¹ **è®¢å•æ¸…ç†**: æ”¯æŒæ‰¹é‡é€‰æ‹©ä¸æ‰¹é‡åˆ é™¤ã€‚
    - â­ **è¯„ä»·ç®¡ç†**: æœç´¢ä¸åˆ é™¤è¯„ä»·ã€‚
    - ğŸ“¦ **æ•°æ®å¯¼å‡º**: è®¢å•/å•†å“/è¯„ä»·/è®¾ç½®å¯¼å‡ºï¼Œæ”¯æŒå…¨é‡ JSON ä¸ D1 SQLã€‚
    - ğŸ“£ **å…¬å‘Šç®¡ç†**: é¦–é¡µå…¬å‘Šé…ç½®ã€‚
    - ğŸ’¾ **æ•°æ®å¯¼å‡º**: æ”¯æŒå¯¼å‡ºè®¢å•ã€å•†å“ã€è¯„ä»·ä¸º CSV/JSONï¼Œä»¥åŠå¯¼å‡ºå…¨é‡æ•°æ®ä¸º D1 å…¼å®¹ SQLã€‚
    - âš™ï¸ **è®¾ç½®**: è·Ÿéšå¿ƒæ„ä¿®æ”¹å•†åº—åç§°ã€‚
    - ğŸ‘¥ **é¡¾å®¢ç®¡ç†**: 
        - æŸ¥çœ‹æ‰€æœ‰é¡¾å®¢åˆ—è¡¨ï¼ŒåŒ…æ‹¬ç§¯åˆ†ã€è®¢å•æ•°ã€æ³¨å†Œæ—¶é—´ç­‰ã€‚
        - æœç´¢é¡¾å®¢ï¼ˆæ”¯æŒ ID ä¸ç”¨æˆ·åï¼‰ã€‚
        - ğŸš« **æ‹‰é»‘/è§£å°**: å¯ç¦æ­¢ç‰¹å®šç”¨æˆ·ç™»å½•ä¸è´­ä¹°ã€‚
        - ç®¡ç†å‘˜å¯æ‰‹åŠ¨ä¿®æ”¹é¡¾å®¢ç§¯åˆ†ã€‚
    - âœ¨ **æ¯æ—¥ç­¾åˆ°ä¸ç§¯åˆ†è®¾ç½®**: 
        - å¯å¼€å¯/å…³é—­æ¯æ—¥ç­¾åˆ°åŠŸèƒ½ã€‚
        - è‡ªå®šä¹‰æ¯æ—¥ç­¾åˆ°å¥–åŠ±ç§¯åˆ†æ•°é¢ã€‚
- **ç§¯åˆ†ç³»ç»Ÿ**:
    - ğŸ“… **æ¯æ—¥ç­¾åˆ°**: ç”¨æˆ·æ¯æ—¥ç­¾åˆ°é¢†å–ç§¯åˆ†ã€‚
    - ğŸ’° **ç§¯åˆ†æŠµæ‰£**: è´­ä¹°å•†å“æ—¶å¯ä½¿ç”¨ç§¯åˆ†æŠµæ‰£é‡‘é¢ï¼ˆæ”¯æŒéƒ¨åˆ†æˆ–å…¨é¢æŠµæ‰£ï¼‰ã€‚
    - ğŸ **ç§¯åˆ†æ”¯ä»˜**: è‹¥ç§¯åˆ†è¶³å¤Ÿæ”¯ä»˜å…¨æ¬¾ï¼Œæ— éœ€è·³è½¬æ”¯ä»˜å¹³å°ç›´æ¥æˆäº¤ã€‚
- **å¤šè¯­è¨€ä¸ä¸»é¢˜**:
    - ğŸŒ **ä¸­è‹±åˆ‡æ¢**ã€‚
    - ğŸŒ“ **æµ…è‰²/æ·±è‰²/è·Ÿéšç³»ç»Ÿ**ã€‚
    - â±ï¸ **è‡ªåŠ¨æ›´æ–° (Upstream Sync)**: æä¾› GitHub Actions è„šæœ¬ï¼ŒFork ç”¨æˆ·å¯å¯ç”¨è‡ªåŠ¨åŒæ­¥ä¸Šæ¸¸æœ€æ–°ä»£ç å¹¶è§¦å‘ Vercel éƒ¨ç½²ã€‚

## ğŸš€ ä¸€é”®éƒ¨ç½²

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fchatgptuk%2Fldc-shop&env=OAUTH_CLIENT_ID,OAUTH_CLIENT_SECRET,MERCHANT_ID,MERCHANT_KEY,ADMIN_USERS,NEXT_PUBLIC_APP_URL&envDescription=Required%20Environment%20Variables&project-name=ldc-shop&repository-name=ldc-shop&stores=%5B%7B%22type%22%3A%22postgres%22%7D%5D)

ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å°†æ‚¨è‡ªå·±çš„å®ä¾‹éƒ¨ç½²åˆ° Vercelã€‚

æ•°æ®åº“ (Vercel Postgres) å°†ä¼šè‡ªåŠ¨é…ç½®å¹¶é“¾æ¥ã€‚

## â˜ï¸ Cloudflare Workers å‘½ä»¤éƒ¨ç½²

è¯·å‚è€ƒ [`_workers_v2/README.md`](./_workers_v2/README.md) ä½¿ç”¨ Wrangler å‘½ä»¤éƒ¨ç½²ä¸é…ç½®ã€‚

## ğŸ³ Docker ä¸€èˆ¬éƒ¨ç½² (Docker Compose)

å¦‚æœä½ æ‹¥æœ‰è‡ªå·±çš„æœåŠ¡å™¨ï¼ˆVPS/NASï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ Docker ä¸€é”®éƒ¨ç½²ï¼š

1.  å…‹éš†ä»“åº“ï¼š
    ```bash
    git clone https://github.com/chatgptuk/ldc-shop.git
    cd ldc-shop
    ```
2.  ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç¯å¢ƒå˜é‡ï¼š
    - æ­¤æ–‡ä»¶é»˜è®¤å¯åŠ¨ä¸€ä¸ª PostgreSQL æ•°æ®åº“ã€‚
    - è¯·åŠ¡å¿…ä¿®æ”¹ `OAUTH_CLIENT_ID`, `OAUTH_CLIENT_SECRET`, `MERCHANT_ID`, `MERCHANT_KEY` ç­‰å…³é”®å‚æ•°ã€‚
3.  å¯åŠ¨æœåŠ¡ï¼š
    ```bash
    docker-compose up -d
    ```
4.  è®¿é—® `http://localhost:3000` å³å¯ä½¿ç”¨ã€‚
    - æ•°æ®åº“æ–‡ä»¶ä¼šæŒä¹…åŒ–åœ¨å½“å‰ç›®å½•çš„ `./postgres-data` æ–‡ä»¶å¤¹ä¸­ã€‚

## ğŸ”„ å¦‚ä½•å¯ç”¨è‡ªåŠ¨æ›´æ–° (Auto Update)

å¦‚æœä½  Fork äº†æœ¬é¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡å¯ç”¨ GitHub Actions æ¥å®ç°æ¯å¤©è‡ªåŠ¨åŒæ­¥ä¸Šæ¸¸æœ€æ–°ä»£ç ï¼ˆå¹¶è§¦å‘ Vercel é‡éƒ¨ç½²ï¼‰ï¼š

1.  è¿›å…¥ä½ çš„ GitHub ä»“åº“é¡µé¢ã€‚
2.  ç‚¹å‡»ä¸Šæ–¹çš„ **Actions** æ ‡ç­¾é¡µã€‚
3.  åœ¨å·¦ä¾§æ æ‰¾åˆ° **Upstream Sync**ã€‚
4.  ç‚¹å‡» **Enable workflow** æŒ‰é’®ã€‚
5.  (å¯é€‰) ç‚¹å‡» **Run workflow** æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡åŒæ­¥æµ‹è¯•ã€‚

å¯ç”¨åï¼Œè„šæœ¬å°†æ¯å¤©å®šæ—¶æ£€æŸ¥ `chatgptuk/ldc-shop:main` çš„æ›´æ–°å¹¶åˆå¹¶åˆ°ä½ çš„ä»“åº“ã€‚

## ğŸ’¡ å»ºè®®ï¼šç»‘å®šè‡ªå®šä¹‰åŸŸå

è™½ç„¶æœ¬ç³»ç»Ÿæ”¯æŒä¸»åŠ¨æŸ¥è¯¢è®¢å•çŠ¶æ€ï¼Œä½†ä¸ºäº†è·å¾—æœ€ä½³çš„ç”¨æˆ·ä½“éªŒï¼ˆå³æ—¶çš„æ”¯ä»˜çŠ¶æ€æ›´æ–°ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶ **å»ºè®®** ç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰åŸŸåï¼ˆå¦‚ `store.yourdomain.com`ï¼‰ã€‚

`vercel.app` å…±äº«åŸŸåæœ‰æ—¶ä¼šè¢«æ”¯ä»˜å¹³å°æˆ–é˜²ç«å¢™æ‹¦æˆªï¼Œå¯èƒ½å¯¼è‡´æ”¯ä»˜å›è°ƒå»¶è¿Ÿæˆ–å¤±è´¥ã€‚ç»‘å®šè‡ªå®šä¹‰åŸŸåå¯ä»¥æœ‰æ•ˆé¿å…æ­¤ç±»é—®é¢˜ã€‚



## âš™ï¸ é…ç½®æŒ‡å—

éƒ¨ç½²æ—¶éœ€è¦é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ã€‚

> **âš ï¸ æ³¨æ„**: 
> ä»¥ä¸‹é…ç½®ä»¥åŸŸå `store.chatgpt.org.uk` ä¸ºä¾‹ï¼Œ**éƒ¨ç½²æ—¶è¯·åŠ¡å¿…æ›¿æ¢ä¸ºä½ è‡ªå·±çš„å®é™…åŸŸåï¼**

### 1. Linux DO Connect (OIDC) é…ç½®
å‰å¾€ [connect.linux.do](https://connect.linux.do) åˆ›å»º/é…ç½®åº”ç”¨ï¼š

*   **åº”ç”¨åç§° (App Name)**: `LDC Store Next` (æˆ–ä»»æ„åç§°)
*   **åº”ç”¨ä¸»é¡µ (App Homepage)**: `https://store.chatgpt.org.uk`
*   **åº”ç”¨æè¿° (App Description)**: `LDC Store Next`
*   **å›è°ƒåœ°å€ (Callback URL)**: `https://store.chatgpt.org.uk/api/auth/callback/linuxdo`

è·å– **Client ID** å’Œ **Client Secret**ï¼Œåˆ†åˆ«å¡«å…¥ Vercel ç¯å¢ƒå˜é‡çš„ `OAUTH_CLIENT_ID` å’Œ `OAUTH_CLIENT_SECRET`ã€‚

### 2. EPay (Linux DO Credit) é…ç½®
å‰å¾€ [credit.linux.do](https://credit.linux.do) åˆ›å»º/é…ç½®åº”ç”¨ï¼š

*   **åº”ç”¨åç§°**: `LDC Store Next` (æˆ–ä»»æ„åç§°)
*   **åº”ç”¨åœ°å€**: `https://store.chatgpt.org.uk`
*   **å›è°ƒ URI**: `https://store.chatgpt.org.uk/callback`
*   **é€šçŸ¥ URL**: `https://store.chatgpt.org.uk/api/notify`

è·å– **Client ID** å’Œ **Client Secret**ï¼Œåˆ†åˆ«å¡«å…¥ Vercel ç¯å¢ƒå˜é‡çš„ `MERCHANT_ID` å’Œ `MERCHANT_KEY`ã€‚

### 3. å…¶ä»–å˜é‡
*   **ADMIN_USERS**: ç®¡ç†å‘˜ç”¨æˆ·åï¼Œé€—å·åˆ†éš”ï¼Œä¾‹å¦‚ `chatgpt,admin`
*   **NEXT_PUBLIC_APP_URL**: ä½ çš„åº”ç”¨å®Œæ•´åŸŸåï¼Œä¾‹å¦‚ `https://store.chatgpt.org.uk`

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

1.  å…‹éš†ä»“åº“ã€‚
2.  å®‰è£…ä¾èµ–:
    ```bash
    npm install
    ```
3.  é“¾æ¥ Vercel é¡¹ç›® (ç”¨äºæ‹‰å–ç¯å¢ƒå˜é‡å’Œæ•°æ®åº“é…ç½®):
    ```bash
    vercel link
    vercel env pull .env.development.local
    ```
4.  è¿è¡Œæ•°æ®åº“è¿ç§»:
    ```bash
    npx drizzle-kit push
    ```
5.  å¯åŠ¨å¼€å‘æœåŠ¡å™¨:
    ```bash
    npm run dev
    ```

## ğŸ“„ è®¸å¯è¯
MIT
